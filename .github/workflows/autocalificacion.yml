name: ğŸ¤– AutocalificaciÃ³n Laboratorio 2

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  autocalificacion:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: ğŸ“¦ Instalar dependencias
      run: |
        if [ -f package.json ]; then
          npm install --no-audit
        else
          echo "âš ï¸ No se encontrÃ³ package.json, creando configuraciÃ³n bÃ¡sica..."
          npm init -y
          npm install jsdom --no-audit
        fi
        
    - name: ğŸ” Verificar estructura de archivos
      run: |
        echo "ğŸ“ Verificando estructura del proyecto..."
        ls -la
        echo "ğŸ“‚ Verificando carpeta assets..."
        if [ -d "assets" ]; then
          ls -la assets/
          if [ -d "assets/css" ]; then
            echo "âœ… Carpeta CSS encontrada"
            ls -la assets/css/
          else
            echo "âŒ Carpeta CSS no encontrada"
          fi
          if [ -d "assets/js" ]; then
            echo "âœ… Carpeta JS encontrada"
            ls -la assets/js/
          else
            echo "âŒ Carpeta JS no encontrada"
          fi
          if [ -d "assets/images" ]; then
            echo "âœ… Carpeta images encontrada"
            ls -la assets/images/
          else
            echo "âš ï¸ Carpeta images no encontrada (opcional)"
          fi
        else
          echo "âŒ Carpeta assets no encontrada"
          exit 1
        fi
        
    - name: ğŸ§ª Ejecutar pruebas HTML
      run: node tests/html-tests.js
      
    - name: ğŸ”— Ejecutar pruebas de enlaces
      run: node tests/assets-tests.js
      
    - name: ğŸ“ Ejecutar pruebas de contenido
      run: node tests/content-tests.js
      
    - name: âš¡ Ejecutar pruebas de JavaScript
      run: node tests/javascript-tests.js
      
    - name: ğŸ“Š Generar reporte final
      run: node tests/run-tests.js
      
    - name: ğŸ“‹ Mostrar resumen de calificaciÃ³n
      run: |
        echo "ğŸ¯ === RESUMEN DE CALIFICACIÃ“N ==="
        if [ -f test-results.json ]; then
          cat test-results.json
        else
          echo "âŒ No se pudo generar el archivo de resultados"
        fi
        echo "================================="
        
    - name: ğŸ“„ Subir reporte como artefacto
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results
        path: test-results.json
        retention-days: 30